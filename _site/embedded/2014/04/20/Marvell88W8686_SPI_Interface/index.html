
<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	
	<title>Marvell88W8686的SPI主控接口</title>
    
	
	<meta name="author" content="Hombo Wang">
	
	<link rel="stylesheet" href="/assets/themes/Snail/css/jquery.fancybox.css">
	<link rel="stylesheet" href="/assets/themes/Snail/css/main.css">
	<link rel="stylesheet" href="/assets/themes/Snail/css/pages/journal.css">
	<link rel="stylesheet" href="/assets/themes/Snail/css/team.css">
	<link rel="stylesheet" href="/assets/themes/Snail/css/static.css">
	<link rel="stylesheet" href="/assets/themes/Snail/css/errors.css">
	<link rel="stylesheet" href="/assets/themes/Snail/google-code-prettify/prettify.css">
	
	<link rel="shortcut icon" href="/assets/themes/Snail/img/favicon.ico">
	
	<script type="text/javascript" src="/assets/themes/Snail/js/jquery.min.js"></script>
	
	<script type="text/javascript" src="/assets/themes/Snail/js/auto_loadmore.js"></script>
	
	<script type="text/javascript" src="/assets/themes/Snail/google-code-prettify/prettify.js"></script>
	
	<script type="text/javascript">
	  $(function(){
		$("pre code").addClass("prettyprint linenums");
		prettyPrint();
	  });
	</script>
	
<!--[if lt IE 9]>
	<script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
<![endif]-->

<!-- atom & rss feed -->
    <link href="/atom.xml" type="application/atom+xml" rel="alternate" title="Sitewide ATOM Feed">
    <link href="/rss.xml" type="application/rss+xml" rel="alternate" title="Sitewide RSS Feed">
</head>
<body>
	<noscript>
		&amp;lt;div id="no-js"&amp;gt;Please enable JavaScript in your browser to experience / fully&amp;lt;/div&amp;gt;
	</noscript>
    <div id="page-container">
		<div>
			<nav>
	<div id="nav-l">
	</div>
	<div id="nav-c">
		<ul id="nav-list" style="width: 700px;">
			<li id="home"><a href="/">Home</a></li>
			
			
			
				
				  
				
			 
				
				  
					
					<li id = "About Me"><a href="/about.html">About Me</a></li>
					
				  
				
			 
				
				  
					
					<li id = "Archive"><a href="/archive.html">Archive</a></li>
					
				  
				
			 
				
				  
				
			 
				
				  
					
					<li id = "Categories"><a href="/categories.html">Categories</a></li>
					
				  
				
			 
				
			 
				
				  
				
			 
				
				  
				
			 
				
				  
				
			 
				
				  
					
					<li id = "Tags"><a href="/tags.html">Tags</a></li>
					
				  
				
			 
				
			 
				
			 
			
			
		</ul>
		<form id="nav-search" method="GET" action="/search.html">
			<div id="search-right-pix">
				<div id="search-left-pix">
					<div id="search-center-pix">
						<div id="search-icon-pix"></div>
						<input name="query" type="text" placeholder="Search">
					</div>
				</div>
			</div>
		</form>
		
		
	</div>
	<div id="nav-r">
	</div>
</nav>
			<div id="page-content">
				
<div id="page-content">
	<div class="cont932">
	<div id="journal-articles-block">
		<div class="journal-article">
			<div class="journal-post-info">
				<div class="journal-cat-box">
				
				
				<div class="journal-cat-box">

<a href="/categories.html#embedded-ref" title="embedded">
	embedded

</a>
</div>
				
				</div>
			</div>
			<div class="journal-body">
				<h1 class="journal-title">Marvell88W8686的SPI主控接口<span class="author">by LoongEmbedded</span>
				</h1>
				<span class="the-article">
				<p>88w8686 是一款低成本、低功耗，支持IEEE 802.11a/g/b MAC/基带/射频(RF)无线局域网标准的片上系统,设计支持IEEE 802.11a/g标准的6、
9、12、18、24、36、48、54M 有效数据速率，和IEEE 802.11 b 标准的1、2、5.5、11 M 数据速率。88w8686 提供IEEE802.11/802.11 b 标准直接序列扩散光谱(DSSS),802.11a/ g 正交频分复用(OFDM)基带调制,媒体访问控制(MAC),CPU,内存,主机接口,直接转换收音机,无线局域网射频(RF）功能相结合的单一集成芯片。</p>

<!--more-->

<p>88w8686 核心功能单元,通过一个高通量互联系统相互连接，如图所示。</p>

<p><img src="http://img.blog.csdn.net/20130609184731593" alt="" /></p>

<p>88W8686 配备了一个完全集成的射频到基带收发器工作在2.4 GHz 的ISM 的802.11g/b端口WLAN应用和5 GHz的UNII WLA 802.11a的无线电波段的无线电波段。该收发器架构包括Marvell的第二代，专门设计用于手机通信。蜂窝频段发射杂散音，噪音和接收干扰被设计在其中。</p>

<p>在手机中由于非常低的频谱发射接收频段，设备不会干扰手机接收和发送高
功率移动电话传输信号。为了获得最佳性能，接收路径上集成的LNA 和AGC 增益调整无缝控制基带功能。整个接收路径已超过90 分贝电压增益。</p>

<p>综合发射机正交基带信号转换，然后为2.4 GHz 和5 GHz 无线电频带传输提供外部功率放大器的RF 信号。</p>

<p>本振频率产生一个完全集成的可编程频率合成器，无需任何外部元件。环路
带宽优化相位噪声和动态效能集中在该芯片上。出于安全考虑，88W8686 支持IEEE 802.11i 安全标准，通过实施高级加密标准（AES）/计数器模式CBC - MAC 协议（CCMP），有线等效保密（WEP）临时密钥完整性协议（TKIP）安全机制。为视频，语音，和多媒体应用，88W8686 支持802.11e 的质量服务（QoS）。还支持蓝牙共存接口。88W8686 支持一个通用的SPI（G - SPI）和SDIO 主机接口，采用QFN 封装或倒装芯片封装。</p>

<h1 id="w8686-g-spi">88W8686 G-SPI主控接口</h1>

<p>88W8686<em>主机接口单元(Host Interface Unit,HIU)</em>连接几个主机接口总线单元到设备(指88W8686)的内部总线上。每个HIU和其他HIU是通过共享到内部总线的连接，但88W8686每次只允许一个HIU被激活。</p>

<p>88W8686的HIU支持G-SPI(通用的SPI)接口和SDIO接口。它支持一个通用的、半双工(half-duplex)、DMA辅助(DMA-assisted)的SPI接口，允许一个主控制器使用通用的SPI协议来访问WLAN设备(指88W8686)。G-SPI接口包含了外部SPI总线和内部共享总线之间的接口电路，如图所示：</p>

<p><img src="http://img.blog.csdn.net/20130609184736000" alt="" /></p>

<p>88W8686在SPI总线上表示为设备，主机单元能够直接访问G-SPI寄存器和通过使用BARs(Base Address Register，基地址寄存器)和DMA引擎来访问设备的共享内存。</p>

<p>SPI单元支持通用的SPI接口协议，工作速率可达50MHz，此接口支持下面的功能：</p>

<ol>
  <li>SPI单元总线设备操作</li>
  <li>SPI单元寄存器读写</li>
  <li>对内部CPU产生中断</li>
  <li>对外部SPI主控制器产生中断(比如S3C2451的SPI控制器)</li>
  <li>通过DMA访问内部共享内存</li>
  <li>对电源管理单元产生唤醒中断</li>
</ol>

<h1 id="g-spi">G-SPI接口信号描述</h1>

<p>88W8686复位后，紧接着使用下面配置输入引脚来设置参数，但是在88W8686复位到一定时间之后，这些引脚立刻改为变他们通常的功能，比如GPIO[5]就作为通常的功能使用。如果要设置一个配置位为0，通过连接一个阻值为100 kΩ的下拉电阻，比如：</p>

<p><img src="http://img.blog.csdn.net/20130609184739406" alt="" /></p>

<p>如果要设置一个配置位为1，则不需要接外部电路</p>

<p><img src="http://img.blog.csdn.net/20130609184743000" alt="" /></p>

<p>88W8686的配置引脚如下图所示：</p>

<p><img src="http://img.blog.csdn.net/20130609184747203" alt="" /></p>

<p>接下来看G-SPI接口引脚的说明：</p>

<p><img src="http://img.blog.csdn.net/20130609184751296" alt="" /></p>

<h1 id="g-spi-1">G-SPI接口功能描述</h1>

<p>G-SPI接口的标准G-SPI物理总线上支持多种简单的地址/数据协议，这些协议通过地址的位数和数据的顺序来区分。</p>

<p>每次通讯由主机通过拉低SCSn信号来发起，从机在检测到SCSn有效(低电平)之后，在每个SCLK的上升沿锁存SDI引脚上输入的数据。当从机要输出数据时，在SCLK的下降沿送出数据。SCLK输入信号在每次通讯的开始和结束都为低电平，中断输入信号SINTn由设备发送给主机(比如S3C2451的SPI主控制器)</p>

<h2 id="transaction-delay">通讯时延(transaction delay)</h2>

<p>第一个数据块是从主机发送到设备(从机)的，这个数据块包含一个地址和读/写标志，地址的最高位(MSB)如果为0表示读，如果为1表示写。</p>

<ul>
  <li>
    <p>写操作时延(write Write Transaction Delay)
 &gt;对于写操作，写操作的数据段紧跟着地址段，地址和数据段之间，不需要主机产生低时钟脉冲。</p>
  </li>
  <li>
    <p>读操作时延(read Write Transaction Delay)</p>

    <blockquote>
      <p>读操作时，在总线上地址段之后和数据段之前要求有一些时延。这些时延表现为<em>TDDR(time delay read register，读寄存器时延)</em>和<em>TDRP(timedelay read port，读端口时延)</em>，这些时延表示设备需要需要一些时间来准备有效数据给主机。</p>
    </blockquote>
  </li>
</ul>

<p>有两种方式来建立这些时延：</p>

<ul>
  <li>第一种：主机通过发送一定数量的<em>虚拟时钟周期(a known number of dummyclock cycles)</em>到设备来创建读操作时延，这些虚拟时钟周期定义在<em>延迟读寄存器(delay readregister)</em>中，也就是说主机要发送的<em>虚拟时钟周期</em>数量由<em>延迟读寄存器</em>的值来定，下面来看此寄存器的定义：</li>
</ul>

<p><img src="http://img.blog.csdn.net/20130609184755281" alt="" /></p>

<p>由上图可知<em>Delay Method</em>的值由<em>SPU Bus Mode寄存器</em>(<code>offset 0x70[2]=1</code>)的<em>Delay_Method</em>位的值来决定，下面来看此寄存器的定义：</p>

<p><img src="http://img.blog.csdn.net/20130609184803765" alt="" /></p>

<p>SPU(SPI host interface unit)表示SPI主机接口单元。</p>

<ul>
  <li>第二种：通过主机在地址段和数据段之间保持(holding)低时钟信号至少一段时间来创建读操作时延(the delay is created bythe host holding the clock signal low for a minimum period of time between the addressand data phases)，此模式通过设置<code>0x70[2]=0</code>来选择。</li>
</ul>

<p>在读操作的数据段区间，主机继续提供时钟脉冲和同时驱动数据到SDI输入引脚或从SDO输出引脚读取数据。</p>

<h2 id="section">数据传输</h2>

<p>主机经常访问G-SPI单元的配置寄存器，为了访问内部内存空间，一些寄存器被定义为端口寄存器。当访问端口寄存器时，从机使用相应的基地址寄存器(BAR)和DMA引擎来从内部内存空间读取数据，或是写入数据内部内存空间。</p>

<p>主机和从机间的每一次传输都是<em>突发模式</em>(一个地址后面跟着多个数据)，在读或写完所要求数量的数据后，主机通过拉高SCSn引脚来结束此次传输。</p>

<h3 id="section-1">端口寄存器访问</h3>

<p>主机读<em>端口寄存器</em>时，对于<em>突发模式</em>的数据长度没有限制(除了内部总线的有效地址范围限制之外)。主机写端口寄存器时，对<em>突发模式</em>的数据长度唯一要求是：长度是DWORDS的倍数。</p>

<p><em>端口寄存器</em>(I/O端口，命令端口，数据端口)被用来访问内部32-bit存储空间和总是32-bit对齐访问。每个端口寄存器都有一个相应的BAR用来读写(BAR作为一个指针指向要读写的内存空间的开始物理地址)。内存也只能32-bit对齐访问，这通过向相应的BAR写入32-bit对齐的数据来是实现，在访问期间，第16bits数据总线最先出现在总线上。</p>

<ul>
  <li>
    <p>写数据到端口寄存器</p>

    <blockquote>
      <p>写数据到端口寄存器，就是依次填满起始位置在BAR的连续的32-bit内存空间。当从从机的数据和命令端口读数据时，DMA引擎连续填充FIFO知道剩余空间不足8个DWORDs。当写数据到设备时，拉高SCSn信号脚来清空FIFO。</p>
    </blockquote>
  </li>
  <li>
    <p>从端口寄存器读数据</p>

    <blockquote>
      <p>当从设备的I/O端口读数据时，可以选择DMA引擎是执行单一读或是突发模式读。突发模式读与读端口和命令端口一样，单一模式读让DMA引擎在内部总线上指向单个DWORD访问。单一模式读通讯必须在返回数据的第一或是第二个16-bit块之后终止。</p>
    </blockquote>
  </li>
</ul>

<h3 id="section-2">配置寄存器访问</h3>

<p>当主机访问端口寄存器之外的其他寄存器时，突发模式长度必须限制在一个16-bit的数，或是如果地址是以DWORD边界对齐的两个16-bit数。当内部总线的单元访问G-SPI接口寄存器，则必须是单个DWORD或是更小来访问。</p>

<p>G-SPI除了端口寄存器之外的接口寄存器，都能以16-bit边界对齐的方式读或是写。当单个16-bit word被读出或写入，通讯可以被终止。</p>

<h2 id="g-si">G-SI时钟频率</h2>

<p>G-SPI时钟频率不能大于内部总线时钟频率的2.5倍，内部总线时钟频率</p>

<p><img src="http://img.blog.csdn.net/20130609184803765" alt="" /></p>

<h2 id="section-3">数据格式</h2>

<p>总共有16个有效数据格式，下面9个数据格式是可用的：</p>

<ul>
  <li>所有4读数据格式，在地址段和数据段之间的延迟时间，时钟信号保持为低电平。</li>
  <li>所有4个写数据格式。</li>
  <li>1个读数据格式，在地址段和数据段之间的延迟时间，时钟信号切换为固定数量的周期。</li>
</ul>

<p>每种读写操作类型都有两种地址长度，要么是8-bit要么是16-bit，而每种地址长度对应有两种数据顺序。</p>

<h3 id="section-4">可编程的时钟周期延迟</h3>

<p>下面是<code>Delay_Method=0</code>的读数据格式，在这种模式下，<code>tdr(r/p)</code>的值代表最后一个地址位和第一个数据位之间的延时时间，这段时间内时钟信号SCLK保持为低电平。有两个不同的延时值，包括从G-SPI配置寄存器读取的值和从G-SPI端口寄存器读取的值。一旦读写操作指定的时延期满，有效的数据就从设备中发出。</p>

<ul>
  <li>
    <p>读数据格式</p>

    <p><img src="http://img.blog.csdn.net/20130609184808203" alt="" /></p>
  </li>
  <li>
    <p>写数据格式</p>

    <p><img src="http://img.blog.csdn.net/20130609184812765" alt="" /> </p>
  </li>
</ul>

<h3 id="section-5">固定的时钟周期延迟</h3>

<p>下面是读数据格式的例子：</p>

<p><img src="http://img.blog.csdn.net/20130609184816609" alt="" /></p>

<p>目前我们G-SPI驱动读数据格式就是采用这种格式。</p>

<h2 id="g-spi-2">G-SPI接口寄存器内存空间</h2>

<p><img src="http://img.blog.csdn.net/20130609184820203" alt="" /></p>

<hr />

<p><em>本文章转自：<a href="http://blog.csdn.net/loongembedded/article/details/9067013">http://blog.csdn.net/loongembedded/article/details/9067013</a></em></p>

				</span>
				<div class="journal-date">Published 20 April 2014</div>
				<div class="journal-tags">
				
				
	 
		<a class="tag-cont" href="/tags.html#embedded-ref">
			<div class="tag-l"></div>
			<div class="tag-c">embedded</div>
			<div class="tag-r"></div>
		</a>
	 
		<a class="tag-cont" href="/tags.html#88w8686-ref">
			<div class="tag-l"></div>
			<div class="tag-c">88w8686</div>
			<div class="tag-r"></div>
		</a>
	 
		<a class="tag-cont" href="/tags.html#wifi-ref">
			<div class="tag-l"></div>
			<div class="tag-c">wifi</div>
			<div class="tag-r"></div>
		</a>
	



				</div>
			</div>
		</div>
		<div class="clearboth"></div>
	</div>
</div>
	<div class="clearboth"></div>
	


  <!-- 多说评论框 start -->
<div id="comments">
    <div class="ds-thread" data-thread-key="/embedded/2014/04/20/Marvell88W8686_SPI_Interface"  data-title="Marvell88W8686的SPI主控接口 - Hombo's Blog"></div>
</div>
<!-- 多说评论框 end -->
<!-- 多说公共JS代码 start (一个网页只需插入一次) -->
<script type="text/javascript">
var duoshuoQuery = {short_name:"hombo"};
	(function() {
		var ds = document.createElement('script');
		ds.type = 'text/javascript';ds.async = true;
		ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
		ds.charset = 'UTF-8';
		(document.getElementsByTagName('head')[0] 
		 || document.getElementsByTagName('body')[0]).appendChild(ds);
	})();
	</script>
<!-- 多说公共JS代码 end -->



	<div class="clearboth"></div>
</div>

			</div>
			<div class="clearboth pagebottom"></div>
		</div>
	</div>
	<footer>
	<div class="footer-940">
		<div class="footer-general-info">
			© 2014 Hombo Wang.<br><br>
			Content licensed under:<br>
			<a class="cc" href="http://creativecommons.org/licenses/by-sa/3.0/">c a b</a><br>
			<a href = "/about.html">About Me</a><br>
		</div>
		<div class="footer-col-cont">
			<div class="footer-nav-col">
				<h4><a>Categories</a></h4>
				<ul>
					
					


  
     
    	<li><a href="/categories.html#android-ref">
    		android <span>1</span>
    	</a></li>
     
    	<li><a href="/categories.html#embedded-ref">
    		embedded <span>2</span>
    	</a></li>
     
    	<li><a href="/categories.html#linux-ref">
    		linux <span>2</span>
    	</a></li>
     
    	<li><a href="/categories.html#daily-ref">
    		daily <span>4</span>
    	</a></li>
     
    	<li><a href="/categories.html#vocore-ref">
    		vocore <span>3</span>
    	</a></li>
     
    	<li><a href="/categories.html#openwrt-ref">
    		openwrt <span>3</span>
    	</a></li>
    
  


				</ul>
			</div>
			<div class="footer-nav-col">
				<h4><a>Pages</a></h4>
				<ul>
					
					
					


  
    
      
    
  
    
      
      	
      	<li><a href="/about.html">About Me</a></li>
      	
      
    
  
    
      
      	
      	<li><a href="/archive.html">Archive</a></li>
      	
      
    
  
    
      
    
  
    
      
      	
      	<li><a href="/categories.html">Categories</a></li>
      	
      
    
  
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
      	
      	<li><a href="/tags.html">Tags</a></li>
      	
      
    
  
    
  
    
  



				</ul>
			</div>
			<div class="footer-nav-col">
				<h4><a>Feed</a></h4>
				<ul>
					<li><a href="/atom.xml">Atom Feed</a></li>
					<li><a href="/rss.xml">RSS Feed</a></li>
				</ul>
			</div>
			<div class="footer-nav-col">
				<h4><a>Links</a></h4>
				<ul>
				 
					<li><a href = "http://hombo.wang">Hombo's Blog</a></li>
				
				</ul>
			</div>
			<div class="footer-nav-col">
				<h4><a href = "/about.html">About Me</a></h4>
				<ul>
				 
					<li><a href = "mailto:wanghongbo@ict.ac.cn">e-mail</a></li>
				 
					<li><a href = "http://cn.linkedin.com/pub/hongbo-wang/70/4b0/921/">LinkedIn</a></li>
				 
					<li><a href = "https://github.com/kingmacrobo">Github</a></li>
				 
					<li><a href = "http://www.weibo.com/mbkg">WeiBo</a></li>
				 
					<li><a href = "http://blog.csdn.net/u013101828">CSDN</a></li>
				
				</ul>
			</div>
			<div class="clearboth"></div>
		</div>
		<div class="clearboth"></div>
	</div>
	<div class="clearboth"></div>
</footer>
	
</body>
</html>

